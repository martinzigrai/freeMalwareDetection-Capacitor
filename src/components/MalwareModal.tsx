import React from 'react';
import {
  IonList,
  IonText,
  IonButton,
  IonItem,
  IonContent,
  IonCol,
  IonSpinner,
} from '@ionic/react';
import './MalwareModal.css';
import '../theme/variables.css';
import { SuspiciousAppInfo } from 'capacitor-freerasp';
import { MalwareItem } from './MalwareItem';
import ConfigModal from './ConfigModal';

const MalwareModal: React.FC<{
  suspiciousApps: SuspiciousAppInfo[];
}> = ({ suspiciousApps }) => {
  const [settingsOpened, setSettingsOpened] = React.useState(false);

  return (
    <>
      {suspiciousApps.length > 0 ? (
        <>
          <IonText className="textTitle">Detected malware:</IonText>

          <IonContent scrollY={true} className="contentContainer">
            <IonList lines="none">
              {suspiciousApps.map((susApp, idx) => {
                return (
                  <IonItem key={idx}>
                    <MalwareItem app={susApp} />
                  </IonItem>
                );
              })}
            </IonList>
          </IonContent>
          <IonButton
            shape="round"
            size="default"
            className="malwareButton"
            onClick={() => setSettingsOpened(true)}
          >
            <IonText className="textStyle">Show Malware Configuration</IonText>
          </IonButton>
          {settingsOpened && (
            <ConfigModal
              visible={settingsOpened}
              onClose={() => setSettingsOpened(false)}
            />
          )}
        </>
      ) : (
        <div className="centeredContainer">
          <IonCol>
            <IonText className="subtitle">Malware not detected.</IonText>
            <br />
            <br />
            <IonText className="textNormal">
              Malware detection may take a moment. Please wait, or review the
              malware configuration.
            </IonText>
            <br />
            <IonSpinner className="spinner" />
          </IonCol>
        </div>
      )}
    </>
  );
};

export default MalwareModal;
