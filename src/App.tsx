import React, { useEffect, useState } from 'react';
import { IonApp, setupIonicReact } from '@ionic/react';
import MalwareDetectionDemo from './pages/FreeRaspDemo';

import { startFreeRASP, SuspiciousAppInfo } from 'capacitor-freerasp';

/* Core CSS required for Ionic components to work properly */
import '@ionic/react/css/core.css';

/* Basic CSS for apps built with Ionic */
import '@ionic/react/css/normalize.css';
import '@ionic/react/css/structure.css';
import '@ionic/react/css/typography.css';

/* Theme variables */
import './theme/variables.css';
import { config } from './malwareDetection.config';

setupIonicReact();

const App: React.FC = () => {
  const [suspiciousApps, setSuspiciousApps] = useState<SuspiciousAppInfo[]>([]);

  const actions = {
    // Android only
    malware: (detectedApps: SuspiciousAppInfo[]) => {
      setSuspiciousApps(detectedApps);
    },
  };

  // start freeRASP
  useEffect(() => {
    (async () => {
      const response = await startFreeRASP(config, actions);
      // eslint-disable-next-line no-console
      console.log('freeRASP started:', response);
    })();
  }, []);

  return (
    <IonApp>
      <MalwareDetectionDemo suspiciousApps={suspiciousApps} />
    </IonApp>
  );
};

export default App;
